package com.surya.feign.controller;


import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.*;

import com.surya.appointment.entity.Appointment;
import com.surya.appointment.feign.DoctorClient;
import com.surya.appointment.feign.PatientClient;
import com.surya.appointment.service.AppointmentService;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/api/v1/appointments")
public class AppointmentController {

    @Autowired
    private AppointmentService appointmentService;

    @Autowired
    private PatientClient patientClient;

    @Autowired
    private DoctorClient doctorClient;

    // Book Appointment
    @PostMapping("/book")
    public ResponseEntity<Appointment> bookAppointment(@RequestBody Appointment appointment) {
        // fetch patient & doctor names using Feign clients
        Map<String, Object> patientData = patientClient.getPatientById(appointment.getPatientId());
        Map<String, Object> doctorData = doctorClient.getDoctorById(appointment.getDoctorId());

        appointment.setPatientName((String) patientData.get("patientName"));
        appointment.setDoctorName((String) doctorData.get("doctorName"));

        Appointment saved = appointmentService.bookAppointment(appointment);
        return ResponseEntity.ok(saved);
    }

    // Get Appointments by Doctor
    @GetMapping("/doctor/{doctorId}")
    public ResponseEntity<List<Appointment>> getAppointmentsByDoctor(@PathVariable Long doctorId) {
        return ResponseEntity.ok(appointmentService.getAppointmentsByDoctorId(doctorId));
    }

    // Get Appointments by Patient
    @GetMapping("/patient/{patientId}")
    public ResponseEntity<List<Appointment>> getAppointmentsByPatient(@PathVariable Long patientId) {
        return ResponseEntity.ok(appointmentService.getAppointmentsByPatientId(patientId));
    }

    // Get All Appointments
    @GetMapping("/all")
    public ResponseEntity<List<Appointment>> getAllAppointments() {
        return ResponseEntity.ok(appointmentService.getAllAppointments());
    }
}
